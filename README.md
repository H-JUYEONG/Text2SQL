# Text2SQL + RAG Agent

ë¬¼ë¥˜ ë„ë©”ì¸ì„ ìœ„í•œ í•˜ì´ë¸Œë¦¬ë“œ ì§ˆì˜ì‘ë‹µ ì‹œìŠ¤í…œ. ìžì—°ì–´ ì§ˆë¬¸ì„ ë¶„ì„í•˜ì—¬ SQL(ë°ì´í„°ë² ì´ìŠ¤ ì¡°íšŒ) ë˜ëŠ” RAG(ë¬¸ì„œ ê²€ìƒ‰)ë¡œ ìžë™ ë¼ìš°íŒ…í•©ë‹ˆë‹¤. (íŠ¹ì • ë„ë©”ì¸ì— ì§‘ì¤‘í•˜ì—¬ Text2SQL ê¸°ìˆ ì„ ê²€ì¦í•˜ê¸° ìœ„í•´ ë¬¼ë¥˜ ë„ë©”ì¸ì„ ì„ íƒí–ˆìŠµë‹ˆë‹¤.)

## ðŸŽ¯ í•µì‹¬ ê¸°ëŠ¥

- **Text2SQL**: ìžì—°ì–´ â†’ SQL ë³€í™˜í•˜ì—¬ PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ ì¡°íšŒ
- **RAG**: PDF ë¬¸ì„œ í´ë” ë¡œë“œ ë° ìž„ë² ë”© ê¸°ë°˜ ê²€ìƒ‰
- **í•˜ì´ë¸Œë¦¬ë“œ ë¼ìš°íŒ…**: LLM ê¸°ë°˜ ì˜ë„ ë¶„ì„ìœ¼ë¡œ SQL/RAG ìžë™ ì„ íƒ
- **Question Agent**: ëª¨í˜¸í•œ ì§ˆë¬¸ ë¶„ì„ ë° ì‚¬ìš©ìžì—ê²Œ ìž¬ì§ˆë¬¸ (HITL)
- **Human-in-the-Loop (HITL)**: 
  - ì¿¼ë¦¬ ìŠ¹ì¸/ê±°ë¶€ (ë²„íŠ¼ UI) ë° í”¼ë“œë°± ê¸°ë°˜ ìž¬ìƒì„±
  - ë¼ìš°íŒ… ë¶ˆí™•ì‹¤ ì‹œ ì‚¬ìš©ìž í™•ì¸
- **ë³´ì•ˆ**: ìŠ¤í‚¤ë§ˆ ê²€ì¦, ì½ê¸° ì „ìš© SQLë§Œ í—ˆìš©

## ðŸ”„ ìž‘ë™ ë°©ì‹

```
ì‚¬ìš©ìž ì§ˆë¬¸
    â†“
[Question Agent] â†’ ëª¨í˜¸ì„± ë¶„ì„
    â”œâ”€ ëª¨í˜¸í•¨ â†’ ì‚¬ìš©ìž ìž¬ì§ˆë¬¸ (HITL)
    â””â”€ ëª…í™•í•¨ â†’ [ë¼ìš°íŒ…] â†’ LLM ì˜ë„ ë¶„ì„
        â”œâ”€ SQL: ìŠ¤í‚¤ë§ˆ ê²€ì¦ â†’ SQL ìƒì„± â†’ ë³´ì•ˆ ê²€ì¦ â†’ ìŠ¹ì¸ ìš”ì²­ (HITL)
        â”‚   â”œâ”€ ìŠ¹ì¸ â†’ ì‹¤í–‰ â†’ ê²°ê³¼ ë°˜í™˜
        â”‚   â””â”€ ê±°ë¶€ â†’ í”¼ë“œë°± â†’ ìž¬ìƒì„±
        â”œâ”€ RAG: PDF ë¬¸ì„œ ê²€ìƒ‰ â†’ ë‹µë³€ ìƒì„±
        â””â”€ UNCERTAIN â†’ ì‚¬ìš©ìž í™•ì¸ (HITL)
```

## ðŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
Text2SQL/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app.py                      # FastAPI ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜
â”‚   â”œâ”€â”€ logistics_agent.py          # ë©”ì¸ ì—ì´ì „íŠ¸
â”‚   â”œâ”€â”€ config.py                   # ì„¤ì •
â”‚   â””â”€â”€ agents/
â”‚       â”œâ”€â”€ routing.py              # SQL/RAG ë¼ìš°íŒ…
â”‚       â”œâ”€â”€ question_agent.py       # ëª¨í˜¸ì„± ë¶„ì„, ì§ˆë¬¸ ë¶„í• 
â”‚       â”œâ”€â”€ sql_nodes.py            # SQL ì›Œí¬í”Œë¡œìš° (ìŠ¹ì¸/ê±°ë¶€)
â”‚       â”œâ”€â”€ rag_nodes.py            # RAG ì›Œí¬í”Œë¡œìš°
â”‚       â”œâ”€â”€ graph_builder.py        # LangGraph êµ¬ì„±
â”‚       â”œâ”€â”€ prompts.py              # í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿
â”‚       â””â”€â”€ security.py             # ë³´ì•ˆ/ìŠ¤í‚¤ë§ˆ ê²€ì¦
â”œâ”€â”€ scripts/                        # ìœ í‹¸ë¦¬í‹° ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ data/                           # DB ë° PDF ë¬¸ì„œ
â”œâ”€â”€ templates/                      # HTML í…œí”Œë¦¿
â””â”€â”€ static/                         # CSS/JS (ë²„íŠ¼ UI)
```

## ðŸ”§ ê¸°ìˆ  ìŠ¤íƒ

### Frontend
- **HTML/CSS/JavaScript** - ì›¹ ì¸í„°íŽ˜ì´ìŠ¤
- **Vanilla JS** - í”„ë ˆìž„ì›Œí¬ ì—†ëŠ” ìˆœìˆ˜ JavaScript

### Backend
- **Python 3.11+** - í”„ë¡œê·¸ëž˜ë° ì–¸ì–´
- **FastAPI** - ë¹„ë™ê¸° ì›¹ í”„ë ˆìž„ì›Œí¬
- **LangGraph 1.0+** - AI ì—ì´ì „íŠ¸ ì›Œí¬í”Œë¡œìš° ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
- **LangChain 1.2+** - LLM í†µí•© ë° SQL/RAG ì—ì´ì „íŠ¸
- **PostgreSQL** - ëŒ€ìƒ ë°ì´í„°ë² ì´ìŠ¤
- **langgraph-checkpoint-postgres** - HITL ìƒíƒœ ì €ìž¥ (ì‚¬ìš©ìž ì‘ë‹µ ëŒ€ê¸° ì¤‘ ì›Œí¬í”Œë¡œìš° ìƒíƒœ ìœ ì§€)

### Infrastructure
- **Docker** - ì»¨í…Œì´ë„ˆí™” (ì´ë¯¸ì§€ ë¹Œë“œ ë° ì‹¤í–‰)
- **docker-compose** - ë©€í‹° ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ (ì•± + PostgreSQL í•¨ê»˜ ì‹¤í–‰)
  - í˜„ìž¬ ë°°í¬ ë°©ì‹: `docker-compose` ì‚¬ìš© (ë‚´ë¶€ì ìœ¼ë¡œ Docker ì‚¬ìš©)
  - `Dockerfile`ë¡œ ì•± ì´ë¯¸ì§€ ë¹Œë“œ â†’ `docker-compose.yml`ë¡œ ì„œë¹„ìŠ¤ ì‹¤í–‰
- **GitHub Actions** - CI/CD íŒŒì´í”„ë¼ì¸ (ìžë™ ë¹Œë“œ ë° ë°°í¬)

## âš™ï¸ í™˜ê²½ ì„¤ì •

í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— `.env` íŒŒì¼ì„ ìƒì„±í•˜ì—¬ í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

```bash
# .env íŒŒì¼ ìƒì„±
cat > .env << EOF
OPENAI_API_KEY="your_openai_api_key_here"
DATABASE_URI="postgresql+psycopg2://text2sql:text2sql@postgres:5432/logistics"
USE_DB_CHECKPOINTER="true"
EOF
```

## ðŸ“ ì‚¬ìš© ì˜ˆì‹œ

### SQL ì§ˆë¬¸ (ê±°ë¶€ í›„ ìž¬ìƒì„±)
```
ì‚¬ìš©ìž: "ë°°ì†¡ì´ ì™„ë£Œë˜ì§€ ì•Šì€ ì£¼ë¬¸ ëª©ë¡ì„ ë³´ì—¬ì¤˜"
ì—ì´ì „íŠ¸: [SQL ìƒì„±] â†’ [ìŠ¹ì¸ ìš”ì²­ ë²„íŠ¼]
ì‚¬ìš©ìž: [ê±°ë¶€] â†’ "ê³ ê° ì´ë¦„ê³¼ êµ¬ë§¤ ë¬¼í’ˆê¹Œì§€ ì•Œê³ ì‹¶ì–´"
ì—ì´ì „íŠ¸: [í”¼ë“œë°± ë°˜ì˜í•˜ì—¬ ìž¬ìƒì„±] â†’ [ìŠ¹ì¸ ìš”ì²­]
```

### ëª¨í˜¸í•œ ì§ˆë¬¸ (HITL)
```
ì‚¬ìš©ìž: "ì„±ê³¼ê°€ ì¢‹ì€ ê¸°ì‚¬ ì¡°íšŒí•´ì¤˜"
ì—ì´ì „íŠ¸: "ì„±ê³¼ ê¸°ì¤€ì´ ë¬´ì—‡ì¸ê°€ìš”? (ë§¤ì¶œ, ë°°ì†¡ ê±´ìˆ˜ ë“±)"
ì‚¬ìš©ìž: "ë°°ì†¡ ì™„ë£Œ ê±´ìˆ˜ ê¸°ì¤€ìœ¼ë¡œ"
ì—ì´ì „íŠ¸: [SQL ìƒì„± ë° ì‹¤í–‰] â†’ [ê²°ê³¼ ë°˜í™˜]
```

### RAG ì§ˆë¬¸ (PDF ë¬¸ì„œ ê²€ìƒ‰)
```
ì‚¬ìš©ìž: "ë°°ì†¡ í”„ë¡œì„¸ìŠ¤ëŠ” ì–´ë–»ê²Œ ë˜ë‚˜ìš”?"
ì—ì´ì „íŠ¸: [PDF ë¬¸ì„œ ê²€ìƒ‰] â†’ [ë‹µë³€ ìƒì„±]
```

## ðŸ”’ ë³´ì•ˆ

- **ì½ê¸° ì „ìš©**: SELECT ì¿¼ë¦¬ë§Œ í—ˆìš©
- **ìŠ¤í‚¤ë§ˆ ê²€ì¦**: ìž˜ëª»ëœ í…Œì´ë¸”/ì»¬ëŸ¼ ì°¸ì¡° ë°©ì§€
- **ì¿¼ë¦¬ ìŠ¹ì¸**: ê¸°ì—… í™˜ê²½ì—ì„œ DB ì†ìƒ ë°©ì§€
- **íƒ€ìž„ì•„ì›ƒ**: ì¿¼ë¦¬ ì‹¤í–‰ ì‹œê°„ ì œí•œ

## ðŸ“š ì°¸ê³  ìžë£Œ

- [LangChain RAG agent](https://docs.langchain.com/oss/python/langchain/rag/)
- [LangChain SQL agent](https://docs.langchain.com/oss/python/langchain/sql-agent/)
- [LangGraph Custom RAG agent](https://docs.langchain.com/oss/python/langgraph/agentic-rag/)
- [LangGraph Custom SQL agent](https://docs.langchain.com/oss/python/langgraph/sql-agent/)
- [Document loaders](https://docs.langchain.com/oss/python/integrations/document_loaders/)
- [Vector stores => in-memory](https://docs.langchain.com/oss/python/integrations/vectorstores#in-memory/)
- [Memory](https://docs.langchain.com/oss/python/langgraph/add-memory#use-in-production/)
